echo "VM ID?" read VM
echo "URL?" read URL
echo "Distro? read DISTRO
echo "Version? read VERSION
DS=local
UBUNTU_18.04_URL=https://cloud-images.ubuntu.com/bionic/current/bionic-server-cloudimg-amd64.img
FEDORA_32_URL=https://download.fedoraproject.org/pub/fedora/linux/releases/32/Cloud/x86_64/images/Fedora-Cloud-Base-32-1.6.x86_64.qcow2

if [ ! -d "./$DISTRO/$VERSION/" ]; then
mkdir ./$DISTRO/$VERSION/
wget -4 -O ./$DISTRO/$VERSION/$DISTRO_$VERSION.qcow2 $DISTRO_$VERSION_URL
else
qm importdisk $VM ./$DISTRO/$VERSION/$DISTRO_$VERSION.qcow2 $DS
fi


echo "Removing Old Template..."
qm destroy $VM
echo "Downloading Image..."
wget -4 -O image.qcow2 $URL
echo "Creating VM"
qm create $VM --memory 2048 --net0 virtio,bridge=vmbr0
echo "Importing Disk.."
qm importdisk $VM image.qcow2 $DS
echo "Adding Disk to VM..."
qm set $VM --scsihw virtio-scsi-pci --scsi0 $DS:$VM/vm-$VM-disk-0.raw
echo "Resizing Disk"
qm resize $VM scsi0 +10G
echo "Adding Cloud-Init CDROM drive, etc..."
qm set $VM --ide2 $DS:cloudinit
qm set $VM --boot c --bootdisk scsi0
qm set $VM --serial0 socket --vga serial0
echo "Creating Template..."
qm template 9000
